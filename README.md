# 命令功能

# 概述
**ambot**是一个amule下载机器人,用于自动搜索并下载p2p网络上的pdf文件,并进行数据文件整理.

## 依赖工具

ghostscript
imagemagic
awk
expect
amule
mysql
redis

## 基础配置和函数定义
ambot由一组shell脚本构成,脚本间相互调用,完整abbot的整体功能.以下各脚本令定义了服务常用的指令.
```
```
## amule-search 文搜索命令
搜索新文件生成新的下载任务，然后添加到下载列表中。

### 工作选项
- -s ***搜索***: 使用关键字命令(amule-key -k)取得最新关键字，生成新任务的放到下载列表中。同时在缓存中维护文件HASH的有效期。任务的解析依赖amulecmd的命令输出。针对amulecmd的输出结果，把文件id写入到本地记录文件，再通过expect命令解析逐个添加到下载队列中。

- -c 把缓存中的所有HASH有效期刷新到最长。

- -C 每次新增加的任务会记录到redis缓存中，设置指定的有效期。当有效期到达，任务还未完成下载，便会被清除。为新进来的任务提供空间，防止列表被无效的僵尸任务占满。任务有效期通过变量HASH_LIFE_SPAN设置.。

## amule-key 关键字管理命令
关键字服务，为其他服务(主要是amule-search)启动关键字管理服务。
- 关键的存取结构
  TODO

### 工作选项
- -l 查看存储的关键字内容。
- -h 显示帮助选项。
- -k 取得下一可用关键字。
- -i 从文件中导入搜索关键字。

## amule-util 基础帮助命令

## amule-task 任务管理命令

### 工作选项
- -c 清除指定任务

- -C 清除过期任务

- -i 显示下载任务统计详情

- -k 产出僵尸进程

- -r 删除指定格式的下载任务

- -s 检查服务可用性,检查服务是否因为不可控因素意外关闭，如果关闭可自动恢复启动。

- -t 显示下载大任务,查询正在进行中的大文件下载任务，在磁盘空间不足时，可以查询出来强制停止掉释放出一部分可用空间。

- -l 停止慢任务,主要是指ghostscript脚本任务，对执行超过指定期限的任务，可以查找出来强制停止。超时期限在kill_slow_task函数中设置。

## amule-book 电子管理命令
## addtask 任务添加命令
## sendmail 邮件发送脚本
## sync 文件同步命令
